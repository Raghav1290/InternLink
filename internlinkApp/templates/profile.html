{% extends 'userbase.html' %}

{% block title %}User Profile{% endblock %}

{% set active_page = 'profile' %}

{% block content %}
<section class="container py-5">
    <div class="row justify-content-center text-center">
        <div class="col-lg-7">
            <h1>{{ profile.role.title() }} Profile</h1>
            <p class="lead text-muted">Manage your profile details for InternLink.</p>
        </div>
    </div>
</section>

<section class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                            {{ message|safe }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <form action="{{ url_for('profile') }}" method="post" enctype="multipart/form-data" novalidate>
                <div class="mb-3">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" class="form-control" id="username" name="username" value="{{ profile.username }}" disabled>
                    <div class="form-text">Username cannot be changed.</div>
                </div>

                <div class="mb-3 text-center">
                    <label for="profile_image" class="form-label d-block">Profile Image</label>
                    {% if profile.profile_image %}
                        <img src="{{ url_for('static', filename=profile.profile_image) }}" alt="Profile Image" class="img-thumbnail rounded-circle mb-3" style="width: 150px; height: 150px; object-fit: cover;">
                        <div class="form-check mt-2">
                            <input class="form-check-input" type="checkbox" id="remove_profile_image" name="remove_profile_image" value="true">
                            <label class="form-check-label" for="remove_profile_image">Remove current image</label>
                        </div>
                    {% else %}
                        <img src="{{ url_for('static', filename='images/default_profile.png') }}" alt="Default Profile Image" class="img-thumbnail rounded-circle mb-3" style="width: 150px; height: 150px; object-fit: cover;">
                    {% endif %}
                    <input type="file" class="form-control mt-3 {% if form_errors.profile_image %} is-invalid{% endif %}" id="profile_image" name="profile_image" accept="image/*">
                    <div class="form-text">Upload a new profile picture. Max file size: 2MB. (Supported formats: PNG, JPG, JPEG, GIF)</div>
                    <div class="invalid-feedback">{{ form_errors.profile_image }}</div>
                </div>


                {% if profile.role == 'admin' %}
                <div class="mb-3">
                    <label for="full_name" class="form-label">Full Name</label>
                    <input type="text" class="form-control{% if form_errors.full_name %} is-invalid{% endif %}" id="full_name" name="full_name" value="{{ profile.full_name }}" required maxlength="100">
                    <div class="invalid-feedback">{{ form_errors.full_name }}</div>
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control{% if form_errors.email %} is-invalid{% endif %}" id="email" name="email" value="{{ profile.email }}" required maxlength="100">
                    <div class="invalid-feedback">{{ form_errors.email }}</div>
                </div>
                {% elif profile.role == 'student' %}
                <div class="mb-3">
                    <label for="full_name" class="form-label">Full Name</label>
                    <input type="text" class="form-control{% if form_errors.full_name %} is-invalid{% endif %}" id="full_name" name="full_name" value="{{ profile.full_name }}" required maxlength="100">
                    <div class="invalid-feedback">{{ form_errors.full_name }}</div>
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" value="{{ profile.email }}" disabled>
                    <div class="form-text">Email cannot be changed directly here for your role.</div>
                </div>
                <div class="mb-3">
                    <label for="university" class="form-label">University</label>
                    <input type="text" class="form-control{% if form_errors.university %} is-invalid{% endif %}" id="university" name="university" value="{{ profile.university }}" required maxlength="100">
                    <div class="invalid-feedback">{{ form_errors.university }}</div>
                </div>
                <div class="mb-3">
                    <label for="course" class="form-label">Course</label>
                    <input type="text" class="form-control{% if form_errors.course %} is-invalid{% endif %}" id="course" name="course" value="{{ profile.course }}" required maxlength="100">
                    <div class="invalid-feedback">{{ form_errors.course }}</div>
                </div>
                <div class="mb-3">
                    <label for="resume" class="form-label">Resume (PDF, Optional)</label>
                    {% if profile.resume_path %}
                        <div class="mb-2">
                            Current: <a href="{{ url_for('static', filename=profile.resume_path) }}" target="_blank">View Resume</a>
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" id="remove_resume" name="remove_resume" value="true">
                                <label class="form-check-label" for="remove_resume">Remove current resume</label>
                            </div>
                        </div>
                    {% endif %}
                    <input type="file" class="form-control{% if form_errors.resume %} is-invalid{% endif %}" id="resume" name="resume" accept=".pdf">
                    <div class="form-text">Upload or replace your resume. Must be a PDF file.</div>
                    <div class="invalid-feedback">{{ form_errors.resume }}</div>
                </div>
                {% elif profile.role == 'employer' %}
                <div class="mb-3">
                    <label for="full_name" class="form-label">Full Name</label>
                    <input type="text" class="form-control{% if form_errors.full_name %} is-invalid{% endif %}" id="full_name" name="full_name" value="{{ profile.full_name }}" required maxlength="100">
                    <div class="invalid-feedback">{{ form_errors.full_name }}</div>
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" value="{{ profile.email }}" disabled>
                    <div class="form-text">Email cannot be changed directly here for your role.</div>
                </div>
                <div class="mb-3">
                    <label for="company_name" class="form-label">Company Name</label>
                    <input type="text" class="form-control{% if form_errors.company_name %} is-invalid{% endif %}" id="company_name" name="company_name" value="{{ profile.company_name }}" required maxlength="100">
                    <div class="invalid-feedback">{{ form_errors.company_name }}</div>
                </div>
                <div class="mb-3">
                    <label for="company_description" class="form-label">Company Description</label>
                    <textarea class="form-control" id="company_description" name="company_description" rows="5">{{ profile.company_description }}</textarea>
                </div>
                <div class="mb-3">
                    <label for="website" class="form-label">Company Website</label>
                    <input type="url" class="form-control{% if form_errors.website %} is-invalid{% endif %}" id="website" name="website" value="{{ profile.website }}" maxlength="100">
                    <div class="invalid-feedback">{{ form_errors.website }}</div>
                </div>
                <div class="mb-3 text-center">
                    <label for="logo" class="form-label d-block">Company Logo</label>
                    {% if profile.logo_path %}
                        <img src="{{ url_for('static', filename=profile.logo_path) }}" alt="Company Logo" class="img-thumbnail mb-3" style="max-width: 150px; height: auto;">
                        <div class="form-check mt-2">
                            <input class="form-check-input" type="checkbox" id="remove_logo" name="remove_logo" value="true">
                            <label class="form-check-label" for="remove_logo">Remove current logo</label>
                        </div>
                    {% else %}
                         <img src="{{ url_for('static', filename='images/default_company_logo.png') }}" alt="Default Company Logo" class="img-thumbnail mb-3" style="max-width: 150px; height: auto;">
                    {% endif %}
                    <input type="file" class="form-control mt-3 {% if form_errors.logo %} is-invalid{% endif %}" id="logo" name="logo" accept="image/*">
                    <div class="form-text">Upload or replace your company logo. (Supported formats: PNG, JPG, JPEG, GIF)</div>
                    <div class="invalid-feedback">{{ form_errors.logo }}</div>
                </div>
                {% endif %}

                <div class="d-grid gap-2 my-3">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                    <a href="{{ url_for('profile') }}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</section>
{% endblock %}